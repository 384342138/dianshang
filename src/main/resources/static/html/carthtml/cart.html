<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <link href="../../css/cartcss/gwc.css" rel="stylesheet"/>
    <link href="../../css/base.css" rel="stylesheet"/>
    <link href="../../css/footer.css" rel="stylesheet"/>
</head>
<body>
<div id="top_show">
    <div id="menu">
        <div id="menu_content">
            <ul id="m_left">
                <li id="ttbar-home"><i class="iconfont"></i><a href="//www.jd.com/cart.html" target="_blank">京东首页</a>
                </li>
                <li class="iconfont red font14"></li>
                <li><a>福建</a></li>

    </ul>
    <ul id="m_right">
      <li id="icon-plus-nickname"></li>
      <li id="m_right_first"><a id="liA4">踩蘑菇的男孩</a><span class="red"><i class="iconfont"></i></span></li>
      <li class="spacer"></li>
      <li class="dt"><a>我的订单</a></li>
      <li class="spacer"></li>
      <li class="dt1"><a>我的京东</a><i class="iconfont"></i></li>
      <li class="spacer"></li>
      <li class="dt"><a>京东会员</a></li>
      <li class="spacer"></li>
      <li class="dt1"><span class="red"><a>企业采购</a></span><i class="iconfont"></i></li>
      <li class="spacer"></li>
      <li class="dt1"><a>客户服务</a><i class="iconfont"></i></li>
      <li class="spacer"></li>
      <li class="dt1"><a>网站导航</a><i class="iconfont"></i></li>
      <li class="spacer"></li>
      <li class="dt"><a>手机京东</a></li>
    </ul>
  </div>
</div>
  <div id="logo and sousuo">
    <div id="logo"></div>
    <div id="search"><input type="text" id="keyword">
    <input type="button" id="button" value="搜索" ></div>


    </div>

    <div id="all">
        <div id="all-left">
            <ul>
                <li>全部商品</li>
                <li>1</li>
            </ul>
        </div>
        <div id="all-right">
            <span>配送至:&nbsp&nbsp</span>
            <select class="select">
                <option>福建省厦门市集美区集美街道</option>
            </select>
        </div>
    </div>
    <div id="goods">
        <div id="shuxing">
            <div id="column t-checkbox">
                <div id="sx">
                    <input type="checkbox" id="toggle" name="toggle-checkboxes" class="jdcheckbox"
                           clstag="clickcart|keycount|xincart|cart_allCheck" checked="checked" @click="allchoose()">全选
                </div>
            </div>
            <div id="sx0"></div>
            <div id="sx1">商品</div>
            <div id="sx2"></div>
            <div id="sx3">单价</div>
            <div id="sx4">数量</div>
            <div id="sx5">小计</div>
            <div id="sx6">操作</div>
        </div>
        <div id="kuang">
            <div id="dianming"><input type="checkbox" id="toggle-checkboxes_up" name="toggle-checkboxes"
                                      class="jdcheckbox" clstag="clickcart|keycount|xincart|cart_allCheck"
                                      checked="checked">艾戈勒手表官方旗舰店
            </div>
            <div id="lianxikefu"></div>
            <div><a id="shop-coupon-btn">优惠券</a><i class="iconfont"></i></div>
        </div>
        <div id="item-header">

    </div>
    <div id="cart_content" v-for="(good,index) in goods">
      <div class="cart_content_1">
        <input name="one" type="checkbox">
      </div>
      <div class="cart_content_2">
        <div class="cart_content_img">
          <img src="../../images/cartimages/11.png">
        </div>
        <div class="cart_content_text">
          <a href="">{{good.proDetail.product.proName}}</a>
        </div>
      </div>
      <div class="cart_content_3">
        <div class="cart_content_select">{{good.proDetail.proType}}</div>
      </div>
      <div class="cart_content_4">
        <div class="cart_content_price">
          <span>¥{{good.proDetail.proPrice}}</span>
      </div>
      </div>
      <div class="cart_content_5">
        <input class="desc" type="button" value="-" @click="changeSub(index)">
        <input class="num" name="carProNum" type="number" v-model="good.carProNum" value="1">
        <input class="add" type="button" value="+" @click="changeAdd(index)">
      </div>
      <div class="cart_content_6">
        <div class="cart_content_price2">
          <span>¥{{calcPrice(index)}}</span>
        </div>
      </div>
      <div class="cart_content_7">
        <a><span @click="del(index)">删除</span></a><br>
        <a href="">移到我的关注</a>
      </div>
    </div>
    <!-- 结算部分   -->
    <div id="content_total">
      <div class="total_left">
        <input type="checkbox">
        <li><input name="all" type="checkbox" @click="allchoose()">全选</li>
        <a href="">删除选中商品</a>
        <a href="">移到关注</a>
        <a class="remove" href="">清理购物车</a>
      </div>
      <div class="total_right">
        <div class="amount">
          <span class="amount_text">已选择&nbsp<em>0</em>&nbsp件商品</span>
        </div>
        <div class="price">
          <span class="price_one">总价：</span>
          <em class="price_two">¥{{calcTotal()}}</em><br>
          <span class="price_three">促销：</span>
          <span class="price_four">-¥0.00</span>
        </div>
        <div class="pay">
          <span class="pay_text"  @click="add()"><a href="../jiesuanhtml/settlement.html">去结算</a></span>
        </div>
      </div>
    </div>
  </div>
</div>
</div>


<!--footer部分-->
<div id="footer">
    <div id="service-2014">
        <div class="slogan">
            <img src="../../images/cartimages/service_items_1.png">
            <img src="../../images/cartimages/service_items_2.png">
            <img src="../../images/cartimages/service_items_3.png">
            <img src="../../images/cartimages/service_items_4.png">
        </div>
        <div class="w">
            <dl class="fore1">
                <dt>购物指南</dt>
                <dd>
                    <div><a>购物流程</a>
                    </div>
                    <div><a>会员介绍</a>
                    </div>
                    <div><a>生活旅行/团购</a>
                    </div>
                    <div><a>常见问题</a></div>
                    <div><a>大家电</a>
                    </div>
                    <div><a>联系客服</a></div>
                </dd>
            </dl>
            <dl class="fore2">
                <dt>配送方式</dt>
                <dd>
                    <div><a>上门自提</a>
                    </div>
                    <div><a>211限时达</a>
                    </div>
                    <div><a>配送服务查询</a>
                    </div>
                    <div><a>配送费收取标准</a>
                    </div>
                    <div><a>海外配送</a></div>
                </dd>
            </dl>
            <dl class="fore3">
                <dt>支付方式</dt>
                <dd>
                    <div><a>货到付款</a>
                    </div>
                    <div><a>在线支付</a>
                    </div>
                    <div><a>分期付款</a>
                    </div>
                    <div><a>邮局汇款</a>
                    </div>
                    <div><a>公司转账</a>
                    </div>
                </dd>
            </dl>
            <dl class="fore4">
                <dt>售后服务</dt>
                <dd>
                    <div><a>售后政策</a>
                    </div>
                    <div><a>价格保护</a>
                    </div>
                    <div><a>退款说明</a>
                    </div>
                    <div><a>返修/退换货</a>
                    </div>
                    <div><a>取消订单</a>
                    </div>
                </dd>
            </dl>
            <dl class="fore5">
                <dt>特色服务</dt>
                <dd>
                    <div><a>夺宝岛</a></div>
                    <div><a>DIY装机</a></div>
                    <div><a>延保服务</a></div>
                    <div><a>京东E卡</a></div>
                    <div><a>京东通信</a></div>
                    <div><a>京东JD+</a></div>
                </dd>
            </dl>
            <div id="coverage">
                <div class="dt">
                    京东自营覆盖区县
                </div>
                <div class="dd">
                    <p>京东已向全国2649个区县提供自营配送服务，支持货到付款、POS机刷卡和售后上门服务。</p>
                    <p class="ar"><a>查看详情&nbsp;&gt;</a>
                    </p>
                </div>
            </div>
            <span class="clr"></span>
        </div>
    </div>
    <div class="copyright">
        <a target="_blank" href=""> <img src="../../images/cartimages/ga.png"> 京公网安备11000002000088号</a>&nbsp;&nbsp;|&nbsp;&nbsp;京ICP证070359号&nbsp;&nbsp;|&nbsp;&nbsp;
        <a target="_blank" href="">互联网药品信息服务资格证编号(京)-经营性-2014-0008</a>&nbsp;&nbsp;|&nbsp;&nbsp;新出发京零&nbsp;字第大120007号<br>互联网出版许可证编号新出网证(京)字150号&nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="" target="_blank">出版物经营许可证</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="" target="_blank">网络文化经营许可证京网文[2014]2148-348号</a>&nbsp;&nbsp;|&nbsp;&nbsp;违法和不良信息举报电话：4006561155<br>Copyright&nbsp;©&nbsp;2004&nbsp;-&nbsp;2016&nbsp;&nbsp;京东JD.com&nbsp;版权所有&nbsp;&nbsp;|&nbsp;&nbsp;消费者维权热线：4006067733<br>京东旗下网站：<a
            href="" target="_blank">京东钱包</a>
    </div>
</div>

</body>
<script src="../../js/cartjs/jquery-3.3.1.js" type="application/javascript"></script>
<script src="../../js/cartjs/jquery.validate.js" type="application/javascript"></script>
<script src="../../js/cartjs/jquery.validate.regex.js" type="application/javascript"></script>
<script src="../../js/cartjs/vue.min.js"></script>

<script>
    var userId;
    window.onload=function () {
        document.getElementById("liA4").innerText = sessionStorage.getItem("userName");
        userId = sessionStorage.getItem("userId");
        var userName=sessionStorage.getItem("userName");
        sessionStorage.setItem("userName",userName);
        sessionStorage.setItem("userId",userId);
        alert(userId);
        // alert(sessionStorage.getItem('userName'));
    }
  var vm = new Vue();
  $(function () {
   $.ajax({
     url:"http://localhost:8080/get/all/cart",
     type:"post",
     data:{"userId":userId},
     dataType:"json",
     success:function (data) {
         vm=new Vue({
            el:"#goods",
             data:{
                "goods":data,
             },
           methods:{
             changeAdd: function (index) {

                            this.goods[index].carProNum++;
                        },
                        changeSub: function (index) {
                            if (this.goods[index].carProNum > 1) {
                                this.goods[index].carProNum--;
                            }
                        },

                        calcPrice: function (i) {
                            return this.goods[i].proDetail.proPrice * this.goods[i].carProNum;
                        },
                        calcTotal: function () {
                            var total = 0;
                            for (var j = 0; j < this.goods.length; j++) {
                                total += this.goods[j].proDetail.proPrice * this.goods[j].carProNum;
                            }
                            return total;
                        },
                        del: function (i) {
                            $.ajax({
                                url: "http://localhost:8080/del",
                                type: "post",
                                data: {
                                    "cartId": this.goods[i].cartId,
                                },
                                dataType: "json",

                            })
                            this.goods.splice(i, 1);

                        },
                        allchoose: function () {

                            if ($("input[name='toggle-checkboxes']").prop("checked")) {
                                $("input[name='one']").prop("checked", true);
                            } else {
                                $("input[name='one']").prop("checked", false);
                            }

                        },

             add: function () {
               var cartAdd=function(cartId,carProNum){
                 this.cartId = cartId;
                 this.carProNum=carProNum;
               }
               var cartadds=new Array();
               for(var i = 0;i < this.goods.length;i++){
                 if($("input[name='one']").eq(i).prop("checked")){
                   var cartadd=new cartAdd(this.goods[i].cartId,this.goods[i].carProNum);
                   cartadds.push(cartadd);

                                }
                            }
                            $.ajax({
                                url: "http://localhost:8080/add",
                                type: "post",
                                data: JSON.stringify(cartadds),
                                dataType: "json",
                                contentType: 'application/json;charset=UTF-8',

                            })


                        }

                    }

                })
                // for(var i =0;i<data.length;i++){
                //   $("input[name='num']").eq(i).val(data[i].carProNum);
                // }
            }
        })
    });


</script>
</html>
